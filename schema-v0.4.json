{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://thedesignlab.io/schemas/course-architect/v0.4",
  "title": "Course Architect Schema",
  "description": "AI-ready course structure with integrated knowledge graph for higher education curriculum",
  "type": "object",
  "version": "0.4",

  "properties": {
    "schema_version": {
      "type": "string",
      "const": "0.4"
    },
    "exported_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 timestamp of export"
    },
    "tool": {
      "type": "string",
      "const": "Course Architect"
    },

    "course": {
      "type": "object",
      "description": "Top-level course metadata",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this course instance"
        },
        "title": {
          "type": "string"
        },
        "code": {
          "type": "string",
          "description": "Course catalog code (e.g., ECON 101)"
        },
        "institution": {
          "type": "string"
        },
        "discipline": {
          "type": "string",
          "description": "Primary academic discipline"
        },
        "subdiscipline": {
          "type": "string",
          "description": "More specific field within discipline"
        },
        "level": {
          "type": "string",
          "enum": ["introductory", "intermediate", "advanced", "graduate", "professional"]
        },
        "credits": {
          "type": "number"
        },
        "duration": {
          "type": "string",
          "description": "e.g., '15 weeks', '1 semester'"
        },
        "delivery_mode": {
          "type": "string",
          "enum": ["in_person", "online_synchronous", "online_asynchronous", "hybrid", "hyflex"]
        },
        "lrmi_alignment": {
          "type": "object",
          "description": "Schema.org/LRMI compatible metadata for web discoverability",
          "properties": {
            "@type": { "type": "string", "const": "Course" },
            "educationalLevel": { "type": "string" },
            "teaches": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Competencies/concepts taught (maps to schema.org/teaches)"
            },
            "assesses": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Competencies assessed (maps to schema.org/assesses)"
            }
          }
        }
      },
      "required": ["title", "discipline", "level"]
    },

    "core_competency": {
      "type": "object",
      "description": "The central through-line of the course",
      "properties": {
        "id": {
          "type": "string"
        },
        "statement": {
          "type": "string",
          "description": "Learners will be able to..."
        },
        "type": {
          "type": "string",
          "enum": ["knowledge", "skill", "integrated", "disposition"],
          "description": "Primary competency classification"
        },
        "external_alignment": {
          "type": "array",
          "description": "Links to external competency frameworks",
          "items": {
            "$ref": "#/$defs/external_alignment"
          }
        }
      },
      "required": ["statement", "type"]
    },

    "modules": {
      "type": "array",
      "description": "Coarse-grained learning units (typically 4-8 per course)",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^module-[a-z0-9-]+$"
          },
          "sequence": {
            "type": "integer",
            "minimum": 1
          },
          "title": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "learning_outcome": {
            "type": "string",
            "description": "What learners will be able to do after this module"
          },
          "bloom_level": {
            "type": "string",
            "enum": ["remember", "understand", "apply", "analyze", "evaluate", "create"],
            "description": "Primary cognitive level targeted"
          },
          "ai_partnership_mode": {
            "type": "string",
            "enum": ["instruct", "guide", "assist", "collaborate", "audit", "witness"],
            "description": "How AI should engage with learners in this module"
          },
          "topics": {
            "type": "array",
            "items": { "type": "string" },
            "description": "High-level topic labels within this module"
          },
          "estimated_duration": {
            "type": "string",
            "description": "e.g., '2 weeks', '3 class sessions'"
          },
          "concept_ids": {
            "type": "array",
            "items": { "type": "string" },
            "description": "References to fine-grained concepts in knowledge_graph.nodes"
          },
          "assessment_ids": {
            "type": "array",
            "items": { "type": "string" },
            "description": "References to assessments associated with this module"
          }
        },
        "required": ["id", "sequence", "title", "learning_outcome", "bloom_level", "ai_partnership_mode"]
      }
    },

    "knowledge_graph": {
      "type": "object",
      "description": "Fine-grained concept map with explicit relationships. Follows Knowledge Space Theory (DAG for prerequisites) and EduCOR ontology patterns.",
      "properties": {
        "metadata": {
          "type": "object",
          "properties": {
            "extraction_method": {
              "type": "string",
              "enum": ["ai_extracted", "faculty_defined", "ai_with_faculty_review", "imported"],
              "description": "How the graph was created"
            },
            "last_validated": {
              "type": "string",
              "format": "date-time"
            },
            "node_count": { "type": "integer" },
            "edge_count": { "type": "integer" },
            "is_dag_valid": {
              "type": "boolean",
              "description": "True if prerequisite edges form a valid DAG (no cycles)"
            }
          }
        },

        "nodes": {
          "type": "array",
          "description": "All entities in the knowledge graph",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Unique identifier, prefixed by type (e.g., concept-1, skill-1)"
              },
              "type": {
                "type": "string",
                "enum": ["concept", "skill", "competency", "threshold_concept", "misconception"],
                "description": "Node classification following EduCOR patterns"
              },
              "label": {
                "type": "string",
                "description": "Human-readable name"
              },
              "description": {
                "type": "string",
                "description": "Detailed explanation of this knowledge unit"
              },
              "bloom_level": {
                "type": "string",
                "enum": ["remember", "understand", "apply", "analyze", "evaluate", "create"],
                "description": "Cognitive level required to master this node"
              },
              "difficulty": {
                "type": "string",
                "enum": ["foundational", "intermediate", "advanced"],
                "description": "Relative difficulty within the course"
              },
              "parent_module_id": {
                "type": "string",
                "description": "Reference to containing module (coarse-to-fine linkage)"
              },
              "keywords": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Search/tagging keywords"
              },
              "external_alignments": {
                "type": "array",
                "items": { "$ref": "#/$defs/external_alignment" },
                "description": "Links to external standards, competency frameworks"
              },
              "ai_notes": {
                "type": "string",
                "description": "Instructor notes for AI tutors about how to teach this concept"
              },
              "common_misconceptions": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Frequent student misunderstandings to watch for"
              },
              "source": {
                "type": "string",
                "enum": ["ai_extracted", "faculty_defined", "imported"],
                "description": "How this node was created"
              }
            },
            "required": ["id", "type", "label"]
          }
        },

        "edges": {
          "type": "array",
          "description": "Relationships between nodes. Prerequisite edges must form a DAG.",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "description": "Unique edge identifier"
              },
              "source": {
                "type": "string",
                "description": "Source node ID"
              },
              "target": {
                "type": "string",
                "description": "Target node ID"
              },
              "relationship": {
                "type": "string",
                "enum": [
                  "prerequisite_of",
                  "builds_on",
                  "part_of",
                  "related_to",
                  "contrasts_with",
                  "applies_to",
                  "example_of",
                  "requires_skill",
                  "develops_skill",
                  "addresses_misconception"
                ],
                "description": "Semantic relationship type"
              },
              "strength": {
                "type": "string",
                "enum": ["required", "recommended", "optional"],
                "description": "How critical is this relationship"
              },
              "confidence": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "AI extraction confidence (1.0 = faculty confirmed)"
              },
              "rationale": {
                "type": "string",
                "description": "Why this relationship exists (for AI and faculty reference)"
              },
              "source": {
                "type": "string",
                "enum": ["ai_extracted", "faculty_defined", "imported"]
              }
            },
            "required": ["source", "target", "relationship"]
          }
        }
      }
    },

    "assessments": {
      "type": "array",
      "description": "All graded and formative assessments",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^assessment-[a-z0-9-]+$"
          },
          "name": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": ["written", "exam", "problem_set", "project", "presentation", "performance", "portfolio", "participation", "peer_review", "reflection"]
          },
          "weight": {
            "type": "number",
            "minimum": 0,
            "maximum": 100,
            "description": "Percentage of final grade"
          },
          "description": {
            "type": "string"
          },
          "module_ids": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Which modules this assessment covers"
          },
          "concept_ids": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Fine-grained concepts assessed (links to knowledge_graph.nodes)"
          },
          "format": {
            "type": "object",
            "properties": {
              "setting": {
                "type": "string",
                "enum": ["take_home", "in_class", "synchronous_online", "asynchronous", "oral", "practical"]
              },
              "time_constraint": {
                "type": "string",
                "description": "e.g., '72 hours', '50 minutes', 'semester-long'"
              },
              "collaboration": {
                "type": "string",
                "enum": ["individual", "pairs", "small_group", "class_wide"]
              },
              "resources_allowed": {
                "type": "string",
                "description": "What materials students may use"
              }
            }
          },
          "ai_policy": {
            "type": "string",
            "enum": ["encouraged", "permitted_with_attribution", "restricted", "prohibited", "required"],
            "description": "How AI may be used for this specific assessment"
          },
          "ai_policy_details": {
            "type": "string",
            "description": "Specific guidance on AI use"
          },
          "vulnerability_audit": {
            "type": "object",
            "description": "AI-era authenticity analysis",
            "properties": {
              "risk_level": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              },
              "dimensions": {
                "type": "object",
                "properties": {
                  "reproducibility": {
                    "type": "string",
                    "enum": ["low", "medium", "high"],
                    "description": "Could AI generate a plausible response?"
                  },
                  "verification": {
                    "type": "string",
                    "enum": ["low", "medium", "high"],
                    "description": "Can you verify the student did the work?"
                  },
                  "uniqueness": {
                    "type": "string",
                    "enum": ["low", "medium", "high"],
                    "description": "Does it require student-specific input?"
                  },
                  "temporal": {
                    "type": "string",
                    "enum": ["low", "medium", "high"],
                    "description": "Is it time-constrained effectively?"
                  },
                  "embodied": {
                    "type": "string",
                    "enum": ["low", "medium", "high"],
                    "description": "Does it require physical presence?"
                  }
                }
              },
              "rationale": {
                "type": "string"
              },
              "audited_at": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "authenticity_features": {
            "type": "array",
            "items": { "type": "string" },
            "description": "What makes this assessment AI-resistant"
          },
          "rubric_id": {
            "type": "string",
            "description": "Reference to associated rubric"
          }
        },
        "required": ["id", "name", "type", "weight"]
      }
    },

    "rubrics": {
      "type": "array",
      "description": "Assessment rubrics with AI-era dimensions",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^rubric-[a-z0-9-]+$"
          },
          "assessment_id": {
            "type": "string"
          },
          "criteria": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "description": { "type": "string" },
                "weight": {
                  "type": "number",
                  "description": "Percentage of assessment grade"
                },
                "category": {
                  "type": "string",
                  "enum": ["content_mastery", "process_quality", "metacognition", "ai_collaboration", "authentic_voice", "contextual_application"],
                  "description": "Rubric dimension category"
                },
                "concept_ids": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Concepts this criterion evaluates"
                },
                "levels": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": { "type": "string" },
                      "points": { "type": "number" },
                      "description": { "type": "string" }
                    },
                    "required": ["name", "points", "description"]
                  }
                }
              },
              "required": ["name", "weight", "levels"]
            }
          }
        },
        "required": ["id", "assessment_id", "criteria"]
      }
    },

    "prerequisites": {
      "type": "object",
      "description": "External prerequisites (prior to this course)",
      "properties": {
        "courses": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "code": { "type": "string" },
              "title": { "type": "string" },
              "required": { "type": "boolean" },
              "concepts_assumed": {
                "type": "array",
                "items": { "type": "string" },
                "description": "What knowledge from this course is assumed"
              }
            }
          }
        },
        "skills": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "skill": { "type": "string" },
              "proficiency_level": {
                "type": "string",
                "enum": ["basic", "intermediate", "advanced"]
              },
              "required": { "type": "boolean" }
            }
          }
        },
        "knowledge": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "area": { "type": "string" },
              "description": { "type": "string" },
              "required": { "type": "boolean" }
            }
          }
        }
      }
    },

    "context": {
      "type": "object",
      "description": "Human context for AI engagement",
      "properties": {
        "ai_policy": {
          "type": "object",
          "properties": {
            "course_level": {
              "type": "string",
              "enum": ["encouraged", "permitted_with_attribution", "restricted", "prohibited", "custom"]
            },
            "rationale": {
              "type": "string",
              "description": "Why this policy"
            },
            "details": {
              "type": "string",
              "description": "Full policy text"
            },
            "skills_to_develop": {
              "type": "array",
              "items": { "type": "string" },
              "description": "What students should learn to do themselves"
            },
            "skills_to_delegate": {
              "type": "array",
              "items": { "type": "string" },
              "description": "What students may appropriately delegate to AI"
            }
          },
          "required": ["course_level"]
        },
        "learner_profile": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["traditional_undergraduate", "adult_learner", "graduate", "professional", "career_changer", "mixed"]
            },
            "typical_background": { "type": "string" },
            "common_challenges": { "type": "string" },
            "motivations": { "type": "string" }
          }
        },
        "teaching_approach": {
          "type": "object",
          "properties": {
            "primary": {
              "type": "string",
              "enum": ["lecture", "discussion", "problem_based", "project_based", "studio", "flipped", "case_based", "inquiry", "hybrid"]
            },
            "secondary": {
              "type": "array",
              "items": { "type": "string" }
            },
            "philosophy": {
              "type": "string",
              "description": "Instructor's pedagogical philosophy"
            }
          }
        },
        "instructor_persona": {
          "type": "object",
          "description": "How AI should represent the instructor's voice",
          "properties": {
            "formality": {
              "type": "string",
              "enum": ["casual", "conversational", "professional", "formal"]
            },
            "encouragement_style": {
              "type": "string",
              "enum": ["warm_supportive", "matter_of_fact", "challenging", "socratic"]
            },
            "feedback_approach": {
              "type": "string",
              "enum": ["strengths_first", "direct", "balanced", "questioning"]
            },
            "phrases_to_use": {
              "type": "array",
              "items": { "type": "string" }
            },
            "phrases_to_avoid": {
              "type": "array",
              "items": { "type": "string" }
            },
            "cultural_considerations": {
              "type": "string"
            }
          }
        },
        "discipline_conventions": {
          "type": "object",
          "properties": {
            "citation_style": { "type": "string" },
            "terminology_notes": { "type": "string" },
            "methodological_conventions": { "type": "string" },
            "ethical_considerations": { "type": "string" },
            "professional_standards": { "type": "string" }
          }
        }
      },
      "required": ["ai_policy"]
    },

    "learning_paths": {
      "type": "array",
      "description": "Suggested sequences through the knowledge graph (supports adaptive learning)",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "target_audience": {
            "type": "string",
            "description": "Who this path is designed for"
          },
          "sequence": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "node_id": { "type": "string" },
                "optional": { "type": "boolean" },
                "notes": { "type": "string" }
              },
              "required": ["node_id"]
            }
          }
        },
        "required": ["id", "name", "sequence"]
      }
    },

    "ai_system_prompt": {
      "type": "object",
      "description": "Auto-generated prompt components for AI tutors",
      "properties": {
        "full_prompt": {
          "type": "string",
          "description": "Complete system prompt ready to use"
        },
        "context_summary": {
          "type": "string",
          "description": "Brief course context for token-limited scenarios"
        },
        "module_prompts": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Module-specific prompt snippets keyed by module ID"
        }
      }
    }
  },

  "$defs": {
    "external_alignment": {
      "type": "object",
      "description": "Link to external competency/standards framework",
      "properties": {
        "framework": {
          "type": "string",
          "enum": ["CTDL-ASN", "CASE", "ESCO", "ONET", "custom"],
          "description": "Which external framework"
        },
        "framework_name": {
          "type": "string",
          "description": "Human-readable framework name"
        },
        "uri": {
          "type": "string",
          "format": "uri",
          "description": "Linked data URI for the competency"
        },
        "code": {
          "type": "string",
          "description": "Framework-specific identifier"
        },
        "label": {
          "type": "string",
          "description": "Human-readable label from the framework"
        }
      },
      "required": ["framework"]
    }
  },

  "required": ["schema_version", "course", "core_competency", "modules", "knowledge_graph", "context"]
}
